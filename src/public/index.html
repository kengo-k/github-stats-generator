<html>
  <head>
    <script src="https://cdn.jsdelivr.net/npm/vue@3.2.41"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts@2"></script>
  </head>
  <body>
    <div id="app"></div>
    <div id="chart"></div>
  </body>
  <script>
    const initChart = (data) => {
      const repos = data.repos;

      const extract = (key) => {
        return repos.map((r) => {
          return r[key];
        });
      };
      const series = extract("commit_count");
      const labels = extract("name");
      var options = {
        series,
        chart: {
          width: 600,
          type: "donut",
          dropShadow: {
            enabled: true,
            color: "#111",
            top: -1,
            left: 3,
            blur: 3,
            opacity: 0.2,
          },
        },
        stroke: {
          width: 0,
        },
        plotOptions: {
          pie: {
            donut: {
              labels: {
                show: true,
                total: {
                  showAlways: true,
                  show: true,
                },
              },
            },
          },
        },
        labels,
        dataLabels: {
          dropShadow: {
            blur: 3,
            opacity: 0.8,
          },
        },
        fill: {
          type: "pattern",
          opacity: 1,
          pattern: {
            enabled: true,
            style: [
              "verticalLines",
              "squares",
              "horizontalLines",
              "circles",
              "slantedLines",
            ],
          },
        },
        states: {
          hover: {
            filter: "none",
          },
        },
        theme: {
          palette: "palette2",
        },
        title: {
          text: "Active Projects in this week(commit count)",
        },
        responsive: [
          {
            breakpoint: 480,
            options: {
              chart: {
                width: 200,
              },
              legend: {
                position: "bottom",
              },
            },
          },
        ],
      };

      var chart = new ApexCharts(document.querySelector("#chart"), options);
      chart.render();
    };

    const app = Vue.createApp({
      el: "#app",
      data() {
        return {};
      },
      mounted() {
        fetch("/api/active_projects")
          .then((response) => response.json())
          .then((data) => initChart(data));
      },
    });
    app.mount("#app");
  </script>
</html>
